<!-- Comments Header with Refresh -->
<div class="d-flex justify-content-between align-items-center mb-3" *ngIf="!loading">
  <h6 class="mb-0">
    <i class="bi bi-chat-left-text me-2"></i>
    Comments ({{ comments.length }})
  </h6>
  <button 
    type="button" 
    class="btn btn-sm btn-outline-secondary" 
    (click)="refreshComments()"
    title="Refresh comments">
    <i class="bi bi-arrow-clockwise"></i>
  </button>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="text-center py-4">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading comments...</span>
  </div>
  <p class="mt-2 text-muted small">Loading comments...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="alert alert-warning alert-dismissible fade show" role="alert">
  <i class="bi bi-exclamation-triangle me-2"></i>
  {{ error }}
  <button type="button" class="btn-close" (click)="error = null" aria-label="Close"></button>
</div>

<!-- Comments List -->
<div class="mb-4" *ngIf="comments.length > 0 && !loading">
  <div class="comment-item border rounded p-3 mb-3 bg-light position-relative" *ngFor="let comment of comments">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <div class="d-flex align-items-center flex-grow-1">
        <div class="user-avatar rounded-circle d-flex align-items-center justify-content-center me-3" 
             [ngClass]="getUserAvatarClass(getAuthorName(comment))"
             style="width: 40px; height: 40px;">
          <span class="text-white fw-semibold">{{ getInitials(getAuthorName(comment)) }}</span>
        </div>
        <div class="flex-grow-1">
          <h6 class="mb-0 fw-semibold">{{ getAuthorName(comment) }}</h6>
          <small class="text-muted">{{ formatDate(getCommentDate(comment)) }}</small>
        </div>
      </div>
      <!-- Delete Button (only show for user's own comments or admin) -->
      <button 
        type="button" 
        class="btn btn-sm btn-outline-danger ms-2" 
        (click)="deleteComment(comment.id!)"
        title="Delete comment">
        <i class="bi bi-trash"></i>
      </button>
    </div>
    <p class="mb-0 comment-content">{{ getCommentContent(comment) }}</p>
  </div>
</div>

<!-- No Comments State -->
<div class="text-center py-4 mb-4" *ngIf="comments.length === 0 && !loading">
  <i class="bi bi-chat-text text-muted" style="font-size: 2rem;"></i>
  <h6 class="mt-2 text-muted">No Comments Yet</h6>
  <p class="text-muted small">Be the first to add a comment about this action.</p>
</div>

<!-- Add Comment -->
<div class="card border-0 bg-light">
  <div class="card-body">
    <h6 class="card-title mb-3">
      <i class="bi bi-plus-circle me-2"></i>
      Add Comment
    </h6>
    <div class="mb-3">
      <label for="commentText" class="form-label">Write your comment here...</label>
      <textarea 
        class="form-control comment-textarea" 
        id="commentText" 
        rows="4" 
        [(ngModel)]="newComment"
        [disabled]="submittingComment"
        placeholder="Share updates, ask questions, or provide feedback about this action...">
      </textarea>
    </div>
    <div class="d-flex justify-content-end">
      <button 
        class="btn btn-dark" 
        (click)="addComment()"
        [disabled]="!newComment.trim() || submittingComment">
        <span *ngIf="submittingComment" class="spinner-border spinner-border-sm me-2" role="status">
          <span class="visually-hidden">Adding...</span>
        </span>
        <i *ngIf="!submittingComment" class="bi bi-send me-2"></i>
        {{ submittingComment ? 'Adding...' : 'Add Comment' }}
      </button>
    </div>
  </div>
</div>
