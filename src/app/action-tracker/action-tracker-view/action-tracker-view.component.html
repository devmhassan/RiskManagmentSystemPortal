<!-- Loading State -->
<div *ngIf="loading" class="text-center py-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-2 text-muted">Loading action details...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="alert alert-danger text-center">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  {{ error }}
  <button class="btn btn-outline-danger btn-sm ms-3" (click)="goBack()">
    <i class="bi bi-arrow-left me-1"></i>
    Back to Actions
  </button>
</div>

<!-- Action Detail View -->
<div *ngIf="action && !loading && !error" class="container-fluid p-4">
  <div class="row">
    <div class="col-lg-8">
      <!-- Main Action Card -->
         <div class="d-flex align-items-center mb-3">
            <button class="btn btn-sm btn-outline-secondary me-3" (click)="goBack()">
              <i class="bi bi-arrow-left me-1"></i>
              Back to Actions
            </button>
            <div class="mt-2">
            <h4 class="mb-0 fw-semibold">{{ action.actionId }}: {{ action.description || 'No description available' }}</h4>
          </div>
          </div>
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 p-4">
        
          <div class="d-flex align-items-center justify-content-between">
            <div class="mt-2">
            <h4 class="mb-0 fw-semibold">{{ action.description || 'No description available' }}</h4>
          </div>
            <span class="badge fs-6"
                  [ngClass]="{
                    'bg-success': action.status === 3,
                    'bg-danger': action.status === 4 || (action.daysOverdue && action.daysOverdue > 0),
                    'bg-warning': action.status === 2,
                    'bg-primary': action.status === 1
                  }">
              <i class="bi me-1" 
                 [ngClass]="{
                   'bi-check-circle': action.status === 3,
                   'bi-exclamation-triangle': action.status === 4 || (action.daysOverdue && action.daysOverdue > 0),
                   'bi-hourglass-split': action.status === 2,
                   'bi-circle': action.status === 1
                 }"></i>
              {{ getStatusDisplayText() }}
            </span>
          </div>
            <p class="mb-0 text-muted">
              <strong>Risk:</strong> {{ action.riskId }} - {{ action.riskTitle || action.riskDescription }}
            </p>
          
        </div>

        <div class="card-body p-0">
          <!-- Tab Navigation -->
          <ul class="nav nav-tabs border-0 px-4 pt-3" id="actionDetailTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link" 
                      [class.active]="activeTab === 'details'"
                      id="details-tab" 
                      type="button" 
                      role="tab" 
                      (click)="setActiveTab('details')"
                      aria-controls="details" 
                      aria-selected="true">
                <i class="bi bi-info-circle me-2"></i>
                Details
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" 
                      [class.active]="activeTab === 'comments'"
                      id="comments-tab" 
                      type="button" 
                      role="tab" 
                      (click)="setActiveTab('comments')"
                      aria-controls="comments" 
                      aria-selected="false">
                <i class="bi bi-chat-left-text me-2"></i>
                Comments
                <span class="badge bg-secondary ms-1">{{ getTabBadgeCount('comments') }}</span>
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" 
                      [class.active]="activeTab === 'attachments'"
                      id="attachments-tab" 
                      type="button" 
                      role="tab" 
                      (click)="setActiveTab('attachments')"
                      aria-controls="attachments" 
                      aria-selected="false">
                <i class="bi bi-paperclip me-2"></i>
                Attachments
                <span class="badge bg-secondary ms-1">{{ getTabBadgeCount('attachments') }}</span>
              </button>
            </li>
          </ul>

          <!-- Tab Content -->
          <div class="tab-content p-4" id="actionDetailTabContent">
            <!-- Details Tab -->
            <div class="tab-pane fade" 
                 [class.show]="activeTab === 'details'"
                 [class.active]="activeTab === 'details'"
                 id="details" 
                 role="tabpanel" 
                 aria-labelledby="details-tab">
              <app-action-details [action]="action"></app-action-details>
            </div>

            <!-- Comments Tab -->
            <div class="tab-pane fade" 
                 [class.show]="activeTab === 'comments'"
                 [class.active]="activeTab === 'comments'"
                 id="comments" 
                 role="tabpanel" 
                 aria-labelledby="comments-tab">
              <app-action-comments [action]="action"></app-action-comments>
            </div>

            <!-- Attachments Tab -->
            <div class="tab-pane fade" 
                 [class.show]="activeTab === 'attachments'"
                 [class.active]="activeTab === 'attachments'"
                 id="attachments" 
                 role="tabpanel" 
                 aria-labelledby="attachments-tab">
              <app-action-attachments [action]="action"></app-action-attachments>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Action Summary Sidebar -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 p-4">
          <h5 class="mb-0 fw-semibold">Action Summary</h5>
        </div>
        <div class="card-body p-4">
          <!-- Status -->
          <div class="mb-4">
            <h6 class="text-muted mb-2">Status</h6>
            <span class="badge bg-success fs-6 px-3 py-2">
              <i class="bi bi-check-circle me-1"></i>
              Completed
            </span>
          </div>

          <!-- Progress -->
          <div class="mb-4">
            <h6 class="text-muted mb-2">Progress</h6>
            <div class="progress mb-2" style="height: 8px;">
              <div class="progress-bar bg-dark" 
                   role="progressbar" 
                   style="width: 100%"
                   aria-valuenow="100" 
                   aria-valuemin="0" 
                   aria-valuemax="100">
              </div>
            </div>
            <small class="text-muted">100%</small>
          </div>

          <!-- Timeline -->
          <div class="mb-4">
            <h6 class="text-muted mb-3">Timeline</h6>
            <div class="row g-3">
              <div class="col-6">
                <label class="form-label text-muted small fw-semibold">Start Date:</label>
                <p class="mb-0 small">10/15/2023</p>
              </div>
              <div class="col-6">
                <label class="form-label text-muted small fw-semibold">Due Date:</label>
                <p class="mb-0 small">11/15/2023</p>
              </div>
              <div class="col-6">
                <label class="form-label text-muted small fw-semibold">Completion Date:</label>
                <p class="mb-0 small">11/10/2023</p>
              </div>
              <div class="col-6">
                <label class="form-label text-muted small fw-semibold">Remaining:</label>
                <p class="mb-0 small">Completed</p>
              </div>
            </div>
          </div>

          <!-- Related Risk -->
          <div class="mb-4">
            <h6 class="text-muted mb-2">Related Risk</h6>
            <button class="btn btn-outline-primary btn-sm w-100">
              View Risk RISK-001
            </button>
          </div>

          <!-- Actions -->
          <div>
            <h6 class="text-muted mb-3">Actions</h6>
            <div class="d-grid gap-2">
              <button class="btn btn-dark">
                Update Status
              </button>
              <button class="btn btn-outline-primary">
                Edit Action
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
